<div *ngIf="!error().error" class="card">
  <div class="row justify-content-between">
    <h5 class="card-header">
      <!-- Radio -->
      <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
        <input type="radio" class="btn-check" name="btnradio" id="btnradio1" 
           [checked]="isCommon() === 0" (click)="setIsCommon(0)" autocomplete="off" />
        <label class="btn btn-outline-primary" for="btnradio1">OFFICE MFO</label>
        <input type="radio" class="btn-check" name="btnradio" id="btnradio2"
        [checked]="isCommon() === 1" (click)="setIsCommon(1)" autocomplete="off" />
        <label class="btn btn-outline-primary" for="btnradio2">COMMON MFO</label>
      </div>
    </h5>
    <div class="">
      <div class="row px-4">
        <div class="col-6">
          <div class="input-group">
            <span class="input-group-text">
              <div class="spinner-border spinner-border-sm text-primary" role="status"
                *ngIf="isSearchLoading(); else showIcon">
                <span class="visually-hidden">Loading...</span>
              </div>
              <ng-template #showIcon>
                <i class="tf-icons bx bx-search"></i>
              </ng-template>
            </span>
            <input type="text" [(ngModel)]="search.MFO" (ngModelChange)="searchMfoOffice()" class="form-control"
              placeholder="Search..." />
          </div>
        </div>
        <div class="col-6">
          <button (click)="isAdd = true; " type="button" class="btn btn-primary float-end" data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasScroll" aria-controls="offcanvasScroll">
            <i class='bx bx-plus'></i>MFO
          </button>
        </div>
      </div>
      <div class="table-responsive text-nowrap w-100">
        <table class="table table-hover mt-5 ">
          <thead>
            <tr>
              <td></td>
              <th>#</th>
              <th>MFO</th>
              <th>Actions</th>
            </tr>
          </thead>

          <ng-container *ngIf="mfo().isLoading">
            <tbody>
              <tr>
                <td colspan="4" class="text-center"><app-spinner></app-spinner>
                </td>
              </tr>
            </tbody>
          </ng-container>
          <tbody *ngFor="let a of mfo().data; let i = index" class="table-border-bottom-0">
            <tr>
              <td style="max-width: 5px;" (click)="expandedRow == i?expandedRow = null :expandedRow = i"><i
                  class='bx bx-chevron-right cursor-pointer'></i>
              </td>
              <td style="max-width: 5px;" class="cursor-pointer"
                (click)="expandedRow == i?expandedRow = null :expandedRow = i">{{i+1}}</td>
              <td style="max-width: 800px;min-width: 800px;" class="cursor-pointer"
                (click)="expandedRow == i?expandedRow = null :expandedRow = i">{{a.mfo}}</td>
              <td>
                <div class="dropdown">
                  <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                    <i class="bx bx-dots-vertical-rounded"></i>
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item cursor-pointer"
                      (click)="mfoData = a; siData = {}; standard = {}; isAdd = true" data-bs-toggle="tooltip"
                      matTooltip="Success Indicator" matTooltipPosition="left" data-bs-toggle="offcanvas"
                      data-bs-target="#offcanvasSI" aria-controls="offcanvasSI"><i class="bx bx-plus me-1"></i>
                      Create</a>
                    <a class="dropdown-item cursor-pointer" (click)="mfoData = a; isAdd = false"
                      data-bs-toggle="tooltip" matTooltip="MFO" matTooltipPosition="left" data-bs-toggle="offcanvas"
                      data-bs-target="#offcanvasScroll" aria-controls="offcanvasScroll"><i
                        class="bx bx-edit-alt me-1"></i> Edit</a>
                    <a class="dropdown-item cursor-pointer" (click)="DeleteMfo(a.mfoId)"><i class="bx bx-trash me-1"></i> Delete</a>
                  </div>
                </div>
              </td>
            </tr>
            <ng-container *ngIf="expandedRow == i">
              <tr *ngFor="let b of a.si; let y = index" class="bg-lightest">
                <td colspan="4" class="p-custom bg-lightest">
                  <div>
                    <div class="row justify-content-between w-100 mb-2">
                      <div class="col-6 cursor-pointer"
                        (click)="expandedRowChild == y ? expandedRowChild = null :expandedRowChild = y">
                        <div class="form-text text-gray">
                          <i class='bx bx-chevron-right'></i>
                          {{b.indicator}}
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="float-end">       
                          <button (click)="setSiData(a,b); isAdd = false" class="btn btn-secondary"
                            data-bs-toggle="offcanvas" data-bs-target="#offcanvasSI" aria-controls="offcanvasSI">
                            <i class='bx bx-edit-alt'></i> EDIT
                          </button> &nbsp;
                          <button (click)="DeleteSI(b.indicatorId)" class="btn btn-danger"
                          >
                          <i class='bx bx-trash text-white'></i>
                        </button>
                        </div>
                     
                      </div>
                    </div>

                    <ng-container *ngIf="expandedRowChild == y">
                      <!-- Bordered Table -->
                      <div class="card">
                        <div class="card-body">
                          <div class="table-responsive text-nowrap">
                            <table class="table table-bordered ">
                              <thead>
                                <th [width]="1">
                                  Rating
                                </th>
                                <th class="text-center">
                                  Quality
                                </th>
                                <th class="text-center">
                                  Timeliness
                                </th>
                              </thead>
                              <tbody>
                                <tr>
                                  <td>5</td>
                                  <td><span *ngIf="b.standard">{{b.standard.qlty5}}</span></td>
                                  <td><span *ngIf="b.standard">{{b.standard.timely5}}</span></td>
                                </tr>
                                <tr>
                                  <td>4</td>
                                  <td><span *ngIf="b.standard">{{b.standard.qlty4}}</span></td>
                                  <td><span *ngIf="b.standard">{{b.standard.timely4}}</span></td>
                                </tr>
                                <tr>
                                  <td>3</td>
                                  <td><span *ngIf="b.standard">{{b.standard.qlty3}}</span></td>
                                  <td><span *ngIf="b.standard">{{b.standard.timely3}}</span></td>
                                </tr>
                                <tr>
                                  <td>2</td>
                                  <td><span *ngIf="b.standard">{{b.standard.qlty2}}</span></td>
                                  <td><span *ngIf="b.standard">{{b.standard.timely2}}</span></td>
                                </tr>
                                <tr>
                                  <td>1</td>
                                  <td><span *ngIf="b.standard">{{b.standard.qlty1}}</span></td>
                                  <td><span *ngIf="b.standard">{{b.standard.timely1}}</span></td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>


                    </ng-container>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<div class="col-lg-4 col-md-6">
  <div class="mt-3">
    <div class="offcanvas offcanvas-end" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
      id="offcanvasScroll" aria-labelledby="offcanvasScrollLabel">
      <div class="offcanvas-header">
        <h5 id="offcanvasScrollLabel" class="offcanvas-title">{{isAdd? 'CREATE': 'UPDATE'}} MFO</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body my-auto mx-0 flex-grow-0">
        <label for="nameWithTitle" class="form-label">MFO</label>
        <input [(ngModel)]="mfoData.mfo" type="text" (ngModelChange)="CheckMfoIfExist()"
          id="nameWithTitle" class="form-control" placeholder="Enter MFO" />
        <br>
        <button [disabled]="mfo().isLoadingSave" type="button"
          class="btn btn-primary mb-2 d-grid w-100 justify-content-center" (click)="isAdd? AddMfo(): EditMfo()">
          <div class="spinner-border spinner-border-sm text-white" role="status"
            *ngIf="mfo().isLoadingSave; else showSubmitLabel">
            <span class="visually-hidden">Loading...</span>
          </div>
          <ng-template #showSubmitLabel>
            {{isAdd ? 'Submit': 'Save changes'}}
          </ng-template>
        </button>
        <button type="button" class="btn btn-outline-secondary d-grid w-100" data-bs-dismiss="offcanvas">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
<div class="col-lg-4 col-md-6">
  <div class="mt-3">
    <div class="offcanvas offcanvas-end" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasSI"
      aria-labelledby="offcanvasSI">
      <div class="offcanvas-header">
        <h5 id="offcanvasSI" class="offcanvas-title">{{isAdd? 'CREATE': 'UPDATE'}} SUCCESS INDICATOR</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body my-auto mx-0 flex-grow-0">
        <label for="nameWithTitle" class="form-label">MFO</label>
        <input [(ngModel)]="mfoData.mfo" type="text" id="nameWithTitle" class="form-control" disabled />
        <br>
        <label for="nameWithTitle" class="form-label">Success Indicator</label>
        <textarea [(ngModel)]="siData.indicator" type="text" id="nameWithTitle" class="form-control"
          placeholder="Enter Success Indicator"></textarea>
        <br>

        <label for="nameWithTitle" class="form-label">QUALITY</label>
        <input [(ngModel)]="standard.qlty5" type="text" id="qlty5" class="form-control mb-2" placeholder="Rating 5" />
        <input [(ngModel)]="standard.qlty4" type="text" id="qlty4" class="form-control mb-2" placeholder="Rating 4" />
        <input [(ngModel)]="standard.qlty3" type="text" id="qlty3" class="form-control mb-2" placeholder="Rating 3" />
        <input [(ngModel)]="standard.qlty2" type="text" id="qlty2" class="form-control mb-2" placeholder="Rating 2" />
        <input [(ngModel)]="standard.qlty1" type="text" id="qlty1" class="form-control mb-2" placeholder="Rating 1" />
        <label for="nameWithTitle" class="form-label">TIMELINESS</label>
        <input [(ngModel)]="standard.timely5" type="text" id="timely5" class="form-control mb-2"
          placeholder="Rating 5" />
        <input [(ngModel)]="standard.timely4" type="text" id="timely4" class="form-control mb-2"
          placeholder="Rating 4" />
        <input [(ngModel)]="standard.timely3" type="text" id="timely3" class="form-control mb-2"
          placeholder="Rating 3" />
        <input [(ngModel)]="standard.timely2" type="text" id="timely2" class="form-control mb-2"
          placeholder="Rating 2" />
        <input [(ngModel)]="standard.timely1" type="text" id="timely1" class="form-control mb-2"
          placeholder="Rating 1" />

        <div style="background-color: #f8f9fa; position: sticky;
        bottom: 0;">
          <button [disabled]="mfo().isLoadingSave" type="button"
            class="btn btn-primary mb-2 d-grid w-100 justify-content-center" (click)="isAdd ? AddSI() : EditSI()">
            <div class="spinner-border spinner-border-sm text-white" role="status"
              *ngIf="mfo().isLoadingSave; else showSubmitLabel">
              <span class="visually-hidden">Loading...</span>
            </div>
            <ng-template #showSubmitLabel>
              {{isAdd ? 'Submit': 'Save changes'}}
            </ng-template>
          </button>
          <!-- <button *ngIf="standard === {}" type="button" class="btn btn-outline-secondary d-grid w-100" data-bs-dismiss="offcanvas">
          Clear Quality and Timeliness Fields
        </button> -->
          <button type="button" class="btn btn-outline-secondary d-grid w-100" data-bs-dismiss="offcanvas">
            Cancel
          </button>
        </div>

      </div>
    </div>
  </div>
</div>